---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import ProductCard from '../components/ProductCard.astro';
import { products as staticProducts } from '../data/products';
import { getProductsFromD1, groupProductsByBase, isShortNameSingleWord, isErsatzteilProduct, isZusatzartikelProduct } from '../lib/d1-products';
import { categories, testimonials, ALLOWED_CATEGORY_NAMES } from '../data/shop-content';
import NewsletterModal from '../components/NewsletterModal';
import FaqSection from '../components/FaqSection';

const db = Astro.locals.runtime?.env?.DB as import('../lib/d1-products').D1Database | undefined;
const fromDb = db ? await getProductsFromD1(db, 100) : staticProducts;
const allowedSet = new Set(ALLOWED_CATEGORY_NAMES);
const rawProducts = fromDb.filter(
	(p) =>
		p.category &&
		allowedSet.has(p.category) &&
		!isErsatzteilProduct(p.name) &&
		!isZusatzartikelProduct(p.name)
);
const grouped = groupProductsByBase(rawProducts).filter((p) => !isShortNameSingleWord(p.name));
// Zufällige Reihenfolge für Startseite
const shuffled = [...grouped].sort(() => Math.random() - 0.5);
const products = shuffled.slice(0, 24);
---

<Layout title="E-Kinderauto - Premium Kinderfahrzeuge">
	<Header />
    <NewsletterModal client:idle />
	<main>
        <!-- Hero Section -->
        <section class="relative h-[85vh] bg-gray-900 text-white overflow-hidden">
            <div class="absolute inset-0">
                <img 
                    src="https://images.unsplash.com/photo-1594787318286-3d835c1d207f?q=80&w=2070&auto=format&fit=crop" 
                    alt="Kind fährt Elektroauto" 
                    class="w-full h-full object-cover opacity-60"
                />
            </div>
            <div class="relative h-full container mx-auto px-6 md:px-12 flex flex-col justify-center items-start">
                <span class="inline-block py-1 px-3 border border-white/30 rounded-full text-xs md:text-sm uppercase tracking-widest font-medium mb-6 bg-white/10 backdrop-blur-sm">
                    Neu eingetroffen
                </span>
                <h1 class="text-5xl md:text-7xl lg:text-8xl font-bold mb-6 max-w-4xl leading-[1.1] tracking-tight">
                    Der Traum vom <br/> ersten Auto.
                </h1>
                <p class="text-lg md:text-xl text-gray-200 mb-8 max-w-xl leading-relaxed">
                    Premium Elektroautos für Kinder. Authentisches Design, maximale Sicherheit und unvergesslicher Fahrspaß.
                </p>
                <div class="flex flex-col sm:flex-row gap-4">
                    <a href="#shop" class="bg-white text-black px-8 py-4 text-sm font-bold uppercase tracking-widest hover:bg-gray-100 transition-colors inline-flex items-center justify-center">
                        Jetzt Shoppen
                    </a>
                    <a href="#video" class="border border-white text-white px-8 py-4 text-sm font-bold uppercase tracking-widest hover:bg-white/10 transition-colors inline-flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                            <path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" />
                        </svg>
                        Video ansehen
                    </a>
                </div>
            </div>
        </section>

        <!-- Trust Badges (Logo Strip) -->
        <section class="py-10 border-b border-gray-100 bg-gray-50">
            <div class="container mx-auto px-6 md:px-12">
                <p class="text-center text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">
                    Bekannt aus & Zertifizierte Qualität
                </p>
                <div class="flex flex-wrap justify-center items-center gap-12 md:gap-24 opacity-50 grayscale">
                    {/* Placeholder Logos */}
                    <span class="text-xl font-bold font-serif">ELTERN</span>
                    <span class="text-xl font-bold">AutoBild</span>
                    <span class="text-xl font-bold italic">TÜV SÜD</span>
                    <span class="text-xl font-bold font-mono">TrustedShops</span>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section class="py-20">
            <div class="container mx-auto px-6 md:px-12">
                <h2 class="text-3xl font-bold mb-12 text-center">Kategorien entdecken</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    {categories.map((cat) => (
                        <a href={cat.slug} class="group relative h-96 overflow-hidden block">
                            <img 
                                src={cat.image} 
                                alt={cat.name} 
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                            />
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors"></div>
                            <div class="absolute bottom-8 left-8">
                                <h3 class="text-2xl font-bold text-white mb-2">{cat.name}</h3>
                                <span class="text-white text-sm font-medium border-b border-white pb-1 group-hover:border-transparent transition-colors">
                                    Jetzt ansehen
                                </span>
                            </div>
                        </a>
                    ))}
                </div>
            </div>
        </section>

        <!-- Product Grid -->
		<section id="shop" class="py-20 bg-white">
            <div class="container mx-auto px-6 md:px-12">
                <div class="flex justify-between items-end mb-12">
                    <div>
                        <h2 class="text-3xl font-bold mb-2">Bestseller</h2>
                        <p class="text-gray-500">Unsere beliebtesten Modelle, von Kunden empfohlen.</p>
                    </div>
                    <a href="/produkte" class="hidden md:block text-sm font-bold border-b border-black pb-1 hover:text-gray-600 hover:border-gray-600 transition-colors">
                        Alle Produkte
                    </a>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
                    {products.map((product) => (
                        <ProductCard product={product} />
                    ))}
                </div>
                
                <div class="text-center mt-12 md:hidden">
                    <a href="/produkte" class="btn-secondary w-full">Alle Produkte anzeigen</a>
                </div>
            </div>
        </section>

        <!-- USP Section (Grid) -->
        <section class="py-20 bg-gray-50">
            <div class="container mx-auto px-6 md:px-12">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0 1.106 1.106 0 0 0-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
                            </svg>
                        </div>
                        <h3 class="font-bold text-lg mb-2">Gratis Versand</h3>
                        <p class="text-gray-500 text-sm">Innerhalb Deutschlands liefern wir versandkostenfrei ab 50€ Bestellwert.</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                            </svg>
                        </div>
                        <h3 class="font-bold text-lg mb-2">Schnelle Lieferung</h3>
                        <p class="text-gray-500 text-sm">Bestellungen bis 14 Uhr werden noch am selben Tag versendet.</p>
                    </div>
                    <div class="text-center">
                         <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z" />
                            </svg>
                        </div>
                        <h3 class="font-bold text-lg mb-2">Qualitätsgarantie</h3>
                        <p class="text-gray-500 text-sm">2 Jahre Garantie auf alle Fahrzeuge und 6 Monate auf Akkus.</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z" />
                            </svg>
                        </div>
                        <h3 class="font-bold text-lg mb-2">Sicher Zahlen</h3>
                        <p class="text-gray-500 text-sm">PayPal, Kreditkarte, Klarna - 100% sichere Abwicklung.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials -->
        <section class="py-20 border-b border-gray-100">
            <div class="container mx-auto px-6 md:px-12">
                <h2 class="text-3xl font-bold mb-16 text-center">Das sagen glückliche Eltern</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    {testimonials.map((t) => (
                        <div class="bg-white p-8 rounded-lg border border-gray-100 shadow-sm">
                            <div class="flex items-center gap-1 mb-4 text-yellow-400">
                                {Array.from({ length: 5 }).map(() => (
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                        <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
                                    </svg>
                                ))}
                            </div>
                            <p class="text-gray-600 mb-6 italic">"{t.text}"</p>
                            <div class="flex items-center gap-4">
                                <img src={t.image} alt={t.name} class="w-12 h-12 rounded-full object-cover" />
                                <div>
                                    <p class="font-bold text-sm">{t.name}</p>
                                    <p class="text-xs text-green-600 font-medium">Verifizierter Käufer</p>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="py-20 bg-gray-50">
            <div class="container mx-auto px-6 md:px-12">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-start">
                    <div>
                        <h2 class="text-3xl font-bold mb-6">Häufig gestellte Fragen</h2>
                        <p class="text-gray-600 mb-8">
                            Du hast Fragen zu unseren Fahrzeugen? Hier findest du die Antworten auf die wichtigsten Fragen.
                            Falls du nicht fündig wirst, ist unser Support für dich da.
                        </p>
                        <a href="#" class="btn-primary">Kontakt aufnehmen</a>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <FaqSection client:visible />
                    </div>
                </div>
            </div>
        </section>

        <!-- SEO Text / Story -->
        <section class="py-20">
            <div class="container mx-auto px-6 md:px-12 max-w-4xl text-center">
                <h2 class="text-2xl font-bold mb-6">Warum E-Kinderauto?</h2>
                <div class="text-gray-600 space-y-4 leading-relaxed">
                    <p>
                        Wir sind mehr als nur ein Shop. Wir sind Eltern, die wissen, wie wichtig strahlende Kinderaugen sind. 
                        Jedes Fahrzeug in unserem Sortiment wurde sorgfältig ausgewählt und getestet.
                    </p>
                    <p>
                        Sicherheit steht bei uns an erster Stelle. Alle Modelle verfügen über moderne Sicherheitsfeatures wie 
                        Soft-Start-Automatik, Bremsautomatik und Fernbedienung für die Eltern. So behältst du immer die Kontrolle, 
                        während dein Kind die Welt entdeckt.
                    </p>
                </div>
            </div>
        </section>
	</main>
</Layout>
