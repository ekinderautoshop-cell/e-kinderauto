---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import ProductCard from '../components/ProductCard.astro';
import NewsletterModal from '../components/NewsletterModal';
import { products as staticProducts } from '../data/products';
import { getProductsFromD1 } from '../lib/d1-products';
import { groupProductsByBase, isShortNameSingleWord, isZusatzartikelProduct } from '../lib/d1-products';

const db = Astro.locals.runtime?.env?.DB as import('../lib/d1-products').D1Database | undefined;
const allFromDb = db ? await getProductsFromD1(db) : staticProducts;
const zusatzRaw = allFromDb.filter((p) => isZusatzartikelProduct(p.name));
const grouped = groupProductsByBase(zusatzRaw);
const products = grouped.filter((p) => !isShortNameSingleWord(p.name));
---

<Layout title="Zusatzartikel - E-Kinderauto">
	<Header />
	<NewsletterModal client:idle />
	<main class="bg-white pb-20">
		<div class="bg-gray-50 py-12 md:py-20 mb-12 border-b border-gray-100">
			<div class="container mx-auto px-6 md:px-12 text-center">
				<h1 class="text-4xl md:text-5xl font-bold mb-4 tracking-tight">Zusatzartikel</h1>
				<p class="text-gray-500 max-w-2xl mx-auto text-lg">
					Hauptplatinen, Fahrtenregler, Rauchmodule, Ladegeräte und weiteres Zubehör.
				</p>
			</div>
		</div>

		<div class="container mx-auto px-6 md:px-12">
			<div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-100">
				<p class="text-sm text-gray-500">{products.length} Produkte</p>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
				{products.map((product) => (
					<ProductCard product={product} />
				))}
			</div>

			{products.length === 0 && (
				<p class="text-center text-gray-500 py-12">Aktuell keine Zusatzartikel gelistet.</p>
			)}
		</div>
	</main>
</Layout>
